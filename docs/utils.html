---

title: Utils


keywords: fastai
sidebar: home_sidebar

summary: "Definition of utility functions that deal with simple but recurrent transformations."
description: "Definition of utility functions that deal with simple but recurrent transformations."
nb_path: "nbs/05_utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/05_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Training-utilities">Training utilities<a class="anchor-link" href="#Training-utilities"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_trainings" class="doc_header"><code>plot_trainings</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L19" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_trainings</code>(<strong><code>training_results</code></strong>, <strong><code>eval_optims</code></strong>=<em><code>True</code></em>, <strong><code>expl_optims</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Plots the training results.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="arrange_shape" class="doc_header"><code>arrange_shape</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L47" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>arrange_shape</code>(<strong><code>obj</code></strong>, <strong><code>mode</code></strong>=<em><code>'expand'</code></em>)</p>
</blockquote>
<p>Makes all lists within a list to have the same length. Can be mode 'cut' or 'expand'</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="best_so_far" class="doc_header"><code>best_so_far</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L64" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>best_so_far</code>(<strong><code>m</code></strong>)</p>
</blockquote>
<p>Returns best value up to each point along the second axis of a matrix for each row.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="convergence_time" class="doc_header"><code>convergence_time</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L73" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>convergence_time</code>(<strong><code>results</code></strong>, <strong><code>tol</code></strong>=<em><code>0.0005</code></em>, <strong><code>T</code></strong>=<em><code>50</code></em>, <strong><code>t_avg</code></strong>=<em><code>20</code></em>, <strong><code>return_diffs</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Returns the convergence with criterion of not changing result by <code>tol</code> for <code>T</code> epochs.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="indiv_convergence_time" class="doc_header"><code>indiv_convergence_time</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L87" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>indiv_convergence_time</code>(<strong><code>results</code></strong>, <strong><code>max_epochs</code></strong>=<em><code>800</code></em>, <strong><code>tol</code></strong>=<em><code>0.0005</code></em>, <strong><code>T</code></strong>=<em><code>50</code></em>, <strong><code>t_avg</code></strong>=<em><code>20</code></em>, <strong><code>return_diffs</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Similar to <a href="/bounce/utils.html#convergence_time"><code>convergence_time</code></a> but with each agent.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_indiv_times" class="doc_header"><code>get_indiv_times</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L94" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_indiv_times</code>(<strong><code>tl_eval</code></strong>, <strong><code>convergence_crit</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Provides convergence times from individual ratios.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Load-and-save-data">Load and save data<a class="anchor-link" href="#Load-and-save-data"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CPU_Unpickler" class="doc_header"><code>class</code> <code>CPU_Unpickler</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L111" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CPU_Unpickler</code>(<strong><code>file</code></strong>, <strong><code>fix_imports</code></strong>=<em><code>True</code></em>, <strong><code>encoding</code></strong>=<em><code>'ASCII'</code></em>, <strong><code>errors</code></strong>=<em><code>'strict'</code></em>) :: <code>Unpickler</code></p>
</blockquote>
<p>Unpickles from GPU to CPU</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_benchmark" class="doc_header"><code>save_benchmark</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L119" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_benchmark</code>(<strong><code>benchmark</code></strong>, <strong><code>N</code></strong>, <strong><code>H</code></strong>, <strong><code>method</code></strong>, <strong><code>suffix</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_benchmark" class="doc_header"><code>load_benchmark</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L127" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_benchmark</code>(<strong><code>N</code></strong>, <strong><code>H</code></strong>, <strong><code>method</code></strong>, <strong><code>suffix</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_checkpoint" class="doc_header"><code>load_checkpoint</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L136" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_checkpoint</code>(<strong><code>H</code></strong>, <strong><code>maxP</code></strong>, <strong><code>ID</code></strong>, <strong><code>episode</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="checkpoint2results" class="doc_header"><code>checkpoint2results</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L141" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>checkpoint2results</code>(<strong><code>N</code></strong>, <strong><code>model</code></strong>, <strong><code>maxP</code></strong>, <strong><code>IDs</code></strong>, <strong><code>episode</code></strong>)</p>
</blockquote>
<p>Loads checkpoints from IDs and converts them to result format.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_model" class="doc_header"><code>save_model</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L161" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_model</code>(<strong><code>agent</code></strong>, <strong><code>H</code></strong>, <strong><code>maxP</code></strong>, <strong><code>ID</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_model" class="doc_header"><code>load_model</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L172" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_model</code>(<strong><code>H</code></strong>, <strong><code>maxP</code></strong>, <strong><code>ID</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="State-transformations">State transformations<a class="anchor-link" href="#State-transformations"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="simplify_layout" class="doc_header"><code>simplify_layout</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L184" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>simplify_layout</code>(<strong><code>L</code></strong>)</p>
</blockquote>
<p>Simplifies the given layout of the form <code>[np.array([0, 1]), np.array([0, 1, 2])]</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fill_layout" class="doc_header"><code>fill_layout</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L195" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fill_layout</code>(<strong><code>L</code></strong>, <strong><code>N</code></strong>)</p>
</blockquote>
<p>Fills layout with single-body terms that are missing.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="state2int" class="doc_header"><code>state2int</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L202" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>state2int</code>(<strong><code>state</code></strong>)</p>
</blockquote>
<p>Takes state vector as binary encoding of an integer.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="state2str" class="doc_header"><code>state2str</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L206" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>state2str</code>(<strong><code>state</code></strong>)</p>
</blockquote>
<p>Takes state vector and outputs a (spaceless) string.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="state_in_list" class="doc_header"><code>state_in_list</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L210" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>state_in_list</code>(<strong><code>state</code></strong>, <strong><code>state_list</code></strong>)</p>
</blockquote>
<p>Checks whether a state vector is in a list of states.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="T" class="doc_header"><code>T</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L214" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>T</code>(<strong><code>state</code></strong>)</p>
</blockquote>
<p>Takes state and converts it to <code>torch.FloatTensor</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="flip" class="doc_header"><code>flip</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L218" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>flip</code>(<strong><code>state</code></strong>, <strong><code>i</code></strong>)</p>
</blockquote>
<p>Flips constraint <code>i</code> from state.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="contained_constraints" class="doc_header"><code>contained_constraints</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L224" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>contained_constraints</code>(<strong><code>state</code></strong>, <strong><code>N</code></strong>)</p>
</blockquote>
<p>Provides a boolean mask indicating the constraints already contained within a larger one in
the given state.
Each group larger than pairs contains 2 of the immediately smaller groups, 3 of the next,
4 of the next and so on. For example, a group of 5 will contain 2 groups of 4, 3 groups of 3 and 4 groups of 2.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="action_mask" class="doc_header"><code>action_mask</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L240" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>action_mask</code>(<strong><code>state</code></strong>, <strong><code>N</code></strong>)</p>
</blockquote>
<p>Mask of the actions that can be performed</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Useful-mathematical-operations">Useful mathematical operations<a class="anchor-link" href="#Useful-mathematical-operations"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dist_exp" class="doc_header"><code>dist_exp</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L245" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dist_exp</code>(<strong><code>xmin</code></strong>, <strong><code>x</code></strong>)</p>
</blockquote>
<p>This function computes an eponential distance given a minimum value (in terms of absolute value).</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dist_poly" class="doc_header"><code>dist_poly</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L249" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dist_poly</code>(<strong><code>x</code></strong>, <strong><code>xmin</code></strong>, <strong><code>xmax</code></strong>, <strong><code>d</code></strong>)</p>
</blockquote>
<p>This function computes a linear decay bound from 1 to 0 given a minimum and maximum value (in terms of
absolute value). Exponentiate the line to get better shapes</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="binomial" class="doc_header"><code>binomial</code><a href="https://github.com/BorjaRequena/bounce/tree/master/bounce/utils.py#L255" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>binomial</code>(<strong><code>n</code></strong>, <strong><code>k</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

